<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/header :: header" th:with="title='Chi tiết đơn hàng - BookHaven'"></head>
<body>
<!-- Navigation -->
<div th:replace="layout/header :: navigation"></div>

<!-- Flash Messages -->
<div th:replace="layout/header :: messages"></div>

<!-- Breadcrumb -->
<section class="bg-light py-3">
    <div class="container">
        <h2>Chi tiết đơn hàng</h2>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
                <li class="breadcrumb-item"><a href="/orders">Đơn hàng</a></li>
                <li class="breadcrumb-item active" th:text="${order.orderNumber}">ORD001</li>
            </ol>
        </nav>
    </div>
</section>

<!-- Order Detail Content -->
<section class="py-5">
    <div class="container">
        <div class="row">
            <!-- Order Info -->
            <div class="col-lg-8 mb-4">
                <!-- Order Header -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Mã đơn hàng: <strong th:text="${order.orderNumber}">ORD001</strong></h5>
                                <p class="text-muted mb-0">
                                    <i class="bi bi-clock"></i>
                                    Ngày đặt: <span th:text="${#temporals.format(order.createdAt, 'dd/MM/yyyy HH:mm')}">
                                            01/01/2025 10:00
                                        </span>
                                </p>
                            </div>
                            <div class="col-md-6 text-md-end">
                                    <span class="badge fs-6"
                                          th:classappend="${order.status == 'PENDING'} ? 'bg-warning text-dark' :
                                                          (${order.status == 'CONFIRMED'} ? 'bg-info' :
                                                          (${order.status == 'SHIPPING'} ? 'bg-primary' :
                                                          (${order.status == 'DELIVERED'} ? 'bg-success' : 'bg-danger')))"
                                          th:text="${order.status == 'PENDING'} ? 'Chờ xử lý' :
                                                   (${order.status == 'CONFIRMED'} ? 'Đã xác nhận' :
                                                   (${order.status == 'SHIPPING'} ? 'Đang giao hàng' :
                                                   (${order.status == 'DELIVERED'} ? 'Đã giao hàng' : 'Đã hủy')))">
                                        PENDING
                                    </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Order Items -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="bi bi-box-seam"></i> Sản phẩm đã đặt
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-borderless mb-0">
                                <thead>
                                <tr>
                                    <th>Sản phẩm</th>
                                    <th>Đơn giá</th>
                                    <th>Số lượng</th>
                                    <th>Thành tiền</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="item : ${order.orderItems}">
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <img th:if="${item.book != null}"
                                                 th:src="${item.book.imageUrl}"
                                                 alt="Book"
                                                 class="rounded me-3"
                                                 style="width: 60px; height: 75px; object-fit: cover;">
                                            <div th:if="${item.book == null}"
                                                 class="bg-secondary rounded d-flex align-items-center justify-content-center me-3"
                                                 style="width: 60px; height: 75px;">
                                                <i class="bi bi-book text-white"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-0" th:text="${item.bookTitle}">Book Title</h6>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                                <span th:text="${#numbers.formatDecimal(item.bookPrice, 0, 'COMMA', 0, 'POINT')} + 'đ'">
                                                    299,000đ
                                                </span>
                                    </td>
                                    <td th:text="${item.quantity}">1</td>
                                    <td>
                                        <strong th:text="${#numbers.formatDecimal(item.subtotal, 0, 'COMMA', 0, 'POINT')} + 'đ'">
                                            299,000đ
                                        </strong>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Shipping Info -->
                <div class="card">
                    <div class="card-header bg-light">
                        <h6 class="mb-0">
                            <i class="bi bi-truck"></i> Thông tin giao hàng
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <strong>Người nhận:</strong><br>
                                <span th:text="${order.receiverName}">Nguyễn Văn A</span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <strong>Số điện thoại:</strong><br>
                                <span th:text="${order.shippingPhone}">0912345678</span>
                            </div>
                            <div class="col-md-12 mb-3">
                                <strong>Địa chỉ giao hàng:</strong><br>
                                <span th:text="${order.shippingAddress}">123 ABC, TP.HCM</span>
                            </div>
                            <div class="col-md-12" th:if="${order.note != null and !order.note.isEmpty()}">
                                <strong>Ghi chú:</strong><br>
                                <span class="text-muted" th:text="${order.note}">Note</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Order Summary -->
            <div class="col-lg-4">
                <div class="card sticky-top" style="top: 20px;">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">Tổng đơn hàng</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Tạm tính:</span>
                            <strong th:text="${#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT')} + 'đ'">
                                500,000đ
                            </strong>
                        </div>

                        <div class="d-flex justify-content-between mb-2">
                            <span>Phí vận chuyển:</span>
                            <strong th:text="${#numbers.formatDecimal(order.shippingFee, 0, 'COMMA', 0, 'POINT')} + 'đ'">
                                30,000đ
                            </strong>
                        </div>

                        <hr>

                        <div class="d-flex justify-content-between mb-3">
                            <h5>Tổng cộng:</h5>
                            <h5 class="text-danger"
                                th:text="${#numbers.formatDecimal(order.grandTotal, 0, 'COMMA', 0, 'POINT')} + 'đ'">
                                530,000đ
                            </h5>
                        </div>

                        <div class="alert alert-info py-2 mb-3">
                            <small>
                                <i class="bi bi-credit-card"></i>
                                Thanh toán: <strong th:text="${order.paymentMethod}">COD</strong>
                            </small>
                        </div>

                        <a href="/orders" class="btn btn-outline-primary w-100">
                            <i class="bi bi-arrow-left"></i> Quay lại đơn hàng
                        </a>
                    </div>
                </div>

                <!-- Support -->
                <div class="card mt-3">
                    <div class="card-body">
                        <h6><i class="bi bi-headset"></i> Cần hỗ trợ?</h6>
                        <p class="small text-muted mb-2">
                            Liên hệ với chúng tôi nếu bạn có bất kỳ thắc mắc nào về đơn hàng.
                        </p>
                        <div class="d-grid gap-2">
                            <a href="tel:1900xxxx" class="btn btn-sm btn-outline-success">
                                <i class="bi bi-telephone"></i> Hotline: 1900-xxxx
                            </a>
                            <a href="mailto:support@bookhaven.com" class="btn btn-sm btn-outline-info">
                                <i class="bi bi-envelope"></i> Email hỗ trợ
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Footer -->
<div th:replace="layout/footer :: footer"></div>

<!-- Scripts -->
<div th:replace="layout/header :: scripts"></div>
</body>
</html>